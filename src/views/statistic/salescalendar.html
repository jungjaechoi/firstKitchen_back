<!DOCTYPE HTML>
<html>
<head>
    <meta charset='utf-8' />
    <link href='/static/fullcalendar/main.css' rel='stylesheet' />
    <script src='/static/fullcalendar/main.js'></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<div id='navibar'></div>

<script type="text/javascript">
    $(document).ready(function () {
        $("#navibar").load("/user/navibar", function () {
        });
    })
</script>

<div id='calendar' class = "container" style = "margin-top: 80px; width: 100% "></div>
        
<div id="table" style="height: 340px; margin-top:50px;">
    <table class="table table-hover" style = "margin-bottom:40px;">
        <thead style = "height: 0px;">
            <tr>
                <th>주문 경로</th>
                <th>건 수</th>
                <th>매출</th>
            </tr>
        </thead>
        <tbody style = "height: 34px;" id="tblShow">
        </tbody>
    </table>
</div>

<script type="text/javascript">

    localStorage.removeItem('date-start');
    localStorage.removeItem('date-end');

    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {

        initialView: 'dayGridMonth',
        expandRows: true,
        aspectRatio: 1.35,
        events: [],
        contentHeight: 330,


        eventClick: function(info) {
            
            

            
          }
    });

    $(document).ready(function(){
        $.ajax({
            url: "/statistic/getTotalEarningByDay",
            type: "get",
            data: {token: localStorage.getItem('token')},
            datatype: "json",
            success: function(result){

                daySales = {}
                const dayEarning = result.dayEarning[0]
                const dayRefund = result.dayRefund[0]

                for(var i = 0 ; i<dayEarning.length; i++){
                    daySales[dayEarning[i].date] = [dayEarning[i].dayEarning]
                }

                let keys = Object.keys(daySales)
                console.log(keys);
                for(var i = 0 ; i<dayRefund.length; i++){
                    if(daySales[dayRefund[i].date]){
                        daySales[dayRefund[i].date].push(dayRefund[i].dayRefund)
                    }
                    else{
                        daySales[dayRefund[i].date] = [dayRefund[i].dayRefund]
                    }
                }

                keys = Object.keys(daySales)

                for(var i = 0 ; i<keys.length ; i++){
                    for(var j = 0 ; j<daySales[keys[i]].length ; j++){
                        if(daySales[keys[i]][j]>0){
                            calendar.addEvent({
                                title: daySales[keys[i]][j],
                                start: keys[i],
                                color: 'white',
                                textColor: 'blue',

                            });
                        }
                        else{
                            calendar.addEvent({
                                title: daySales[keys[i]][j],
                                start: keys[i],
                                color: 'white',
                                textColor: 'red'
                            });
                        }
                    }
                }
                
                calendar.render();
                calendar.updateSize();
            }
        })
    })

    

</script>  

<script src= "https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</body>
</html>